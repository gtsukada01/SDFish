<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Debug</title>
</head>
<body>
    <h1>Testing Dashboard Query</h1>
    <div id="results"></div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

        const supabase = createClient(
            'https://ulsbtwqhwnrpkourphiq.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVsc2J0d3Fod25ycGtvdXJwaGlxIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NjU4OTIyOSwiZXhwIjoyMDcyMTY1MjI5fQ.35Wwadw4fhNKsapJIiul4fZxTc7HQmKNTMrKY0Sv_6U'
        )

        async function testQuery() {
            const startDate = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
            const endDate = new Date().toISOString().split('T')[0]

            console.log('Query range:', startDate, 'to', endDate)

            const { data, error, count } = await supabase
                .from('trips')
                .select(\`
                    id,
                    trip_date,
                    trip_duration,
                    anglers,
                    boats!inner(id, name, landing_id, landings!inner(id, name)),
                    catches!inner(species, count)
                \`, { count: 'exact' })
                .gte('trip_date', startDate)
                .lte('trip_date', endDate)
                .order('trip_date', { ascending: false })
                .limit(100)

            const results = document.getElementById('results')
            if (error) {
                results.innerHTML = \`<p style="color:red">ERROR: \${error.message}</p>\`
                console.error('Query error:', error)
            } else {
                const uniqueDates = new Set(data.map(t => t.trip_date))
                results.innerHTML = \`
                    <p><strong>Total trips found: \${count}</strong></p>
                    <p>Unique dates: \${uniqueDates.size}</p>
                    <p>Showing first \${data.length} trips</p>
                    <h3>Dates with trips:</h3>
                    <ul>\${Array.from(uniqueDates).sort().map(d => \`<li>\${d}</li>\`).join('')}</ul>
                \`
                console.log('Query success:', count, 'trips across', uniqueDates.size, 'dates')
                console.log('Sample data:', data.slice(0, 3))
            }
        }

        testQuery()
    </script>
</body>
</html>
